<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>My Account</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="myaccount.css">
	<link href='https://fonts.googleapis.com/css?family=Spectral SC' rel='stylesheet'>
	
</head>

<body>
  <nav class="navbar navbar-inverse" style="margin-bottom: 0px;">
    <div class="container-fluid">
      <div class="navbar-header">
        <img src="croissant.png" style="height:40px; margin-top: 3px; margin-bottom: 3px; margin-right:8px">
        <a class="navbar-brand" style="color:white ; text-shadow: 1px 1px black; font-family:Palatino Linotype, sans-serif; font-size:26px" href="index.html">QuizEd</a>
      </div>
      <div id="keys" style="display:none">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Home</a></li>
          <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="classroom.html">Classes <span class="caret"></span></a>
            <ul class="dropdown-menu" id="dropdown-menu">
            </ul>

          </li>
          <li><a href="classroomcreation.html">Classroom Creation</a></li>
          <li><a href="quiz.html">Quiz Creation</a></li>
          <li><a href="thequiz.html">Host a quiz</a></li>
        </ul>
      </div>
      <div id = "stukeys" style="display:none">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Home</a></li>
        <li><a href="thequiz.html">Join a quiz</a></li>
      </ul>
      </div>
      <div id="logsign" style="display : none">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#" onclick="signShow()"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
          <li><a href="#" onclick="logShow()"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
        </ul>
      </div>
      <div id="accountout" style="display : none">
        <ul class="nav navbar-nav navbar-right">
          <li class = "active"><a href="myaccount.html"><span class="glyphicon glyphicon-user"></span> My Account</a></li>
          <li><a href="#" onclick="logOut()"><span class="glyphicon glyphicon-log-in"></span> Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>



    <div class="">
        <!-- UI - X Starts -->
        <div class="ui-67" style="width:100%">

            <!-- Head Starts -->
            <div class="ui-head bg-lblue" style="background: url('http://hdwpro.com/wp-content/uploads/2017/05/3D-Back-to-School.jpg') no-repeat center center fixed;-webkit-background-size: cover; -moz-background-size: cover; background-size: fill; -o-background-size: cover;">
                <!-- Details -->
                <div class="ui-details">
                    <!-- Name -->
                    <h3 style="font-size:50px" class="changedfont" id="name-header">Nobody</h3>
                    <!-- Designation -->
                    <h4 class="changedfont" id="type-header">Some sort of account</h4>
                </div>
                <!-- Image -->
                <div class="ui-image">
				 <div style="height:120px;width;120px">
                    <!-- User Image -->
                    <img id="profileimage" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQhm0bo0KhH5PqP4wUjD4ZRA3fDy9JiLigMDL11TILWRGjwhHam3w" alt="Profile Picture" class="img-responsive" width="100" height="100">
				 </div>
                </div>
            </div>
            <!-- Head Ends -->

            <!-- Content Starts -->
            <div class="ui-content">

                <div class="row">
<!--   class="row"  class="col-sm-8 col-md-8 col-lg-8 col-lg-offset-2 acc-col"    -->
                    <div  style="text-align:center; background-color: #ded1e7;border:solid #8080ff 5px;border-radius:20px;width:70%;margin-top:80px;margin-left:15%; margin-bottom:20px; padding:2%" width="600x">
                        
                            <center>
                                <h3>Contact Information</h3>
                                <h5>Update Contact Information</h5>
                                <div class="row">


                                    <input type="email" class="email" id="inputEmail3" placeholder="user@example.com">
                                    <button class="btn" onclick="emailchange()">Update Email</a>
                                </div><br>

                                <h3>Login Information</h3>
                                <h5>Click the button to reset your password</h5>
                                <button type="button" class="btn" onclick="resetpass()">Reset Password</button><br><br>
                                    <p id="errorid"></p>
									
									
									<br><h3>Personal settings:</h3>
									<input type="text" class="teachercode" placeholder = "Image URL" id = "imageURL"><button type = "button" class="btn" onclick="imageChange()">Change Image</button>
									<br>
									<input type="text" class="teachercode" placeholder = "Your Name" id = "realName"><button type = "button" class="btn" onclick="nameChange()">Change Name</button>
									<br><br><h3>Teacher Code:</h3>
                                    <h5>Enter Teacher Code. To receive your teacher code, please contact the admiistrator and provide the proof of employment as a teacher.</h5>
                                    <input type="text" class="teachercode" id="teachercode" placeholder="Teacher Code:"><button id="teachercodesub" type="button" class="btn" onclick = "teacherSub()">Submit code</button>

                            </center>
                        

                    </div>
                        <!-- col-8 -->
                </div>

            </div>
                <!-- Content Ends -->
        </div>
            <!-- UI - X Ends -->
    </div>

</body>
<script src="https://www.gstatic.com/firebasejs/4.5.2/firebase.js"></script>
<script>
    var myuser;
    var config = {
        apiKey: "AIzaSyCC63aB9OixrMJsXmtFnnUSlVGDvNgRw30",
        authDomain: "quiz-ed.firebaseapp.com",
        databaseURL: "https://quiz-ed.firebaseio.com",
        projectId: "quiz-ed",
        storageBucket: "quiz-ed.appspot.com",
        messagingSenderId: "690022150231"
    };
    firebase.initializeApp(config);

    var user = firebase.auth().currentUser;


    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            var user = user;
            myuser = user;
            if (!user.emailVerified) {
                user.sendEmailVerification().then(function() {
                    alert("A verification email has been sent to your address, please use it before you can log in");
                    firebase.auth().signOut();
                }).catch(function(error) {

                });
            } else {
                console.log('user', user);
                $("#forms").fadeOut(500);
                $("#LogInForm").fadeOut(500);
                $("#SignInForm").fadeOut(500);
                $("#logsign").hide();
                $("#accountout").show();
            }
        } else {
            window.location = "index.html";
        }
        fillpage();
        teachcheck();
		
		var ref = firebase.database().ref("Teachers/" + user.uid + "/Classrooms");
		ref.on("child_added", function(snapshot){
			var drpDwnMenu = document.getElementById("dropdown-menu");
			var node = document.createElement("LI");
			drpDwnMenu.appendChild(node);
			var href = "classroom.html";
			href += "?classroom=" + snapshot.key;
			var newListItem = $(drpDwnMenu).append("<a href='" + href + "'>" + snapshot.key + "</a>");
		});
    });

    function teachcheck() {
        firebase.database().ref("Teachers/" + myuser.uid).once("value", snapshot => {
            const data = snapshot.val();
            if (data) {
                $("#keys").show();
            }
            else{
              $("#stukeys").show();
            }
        });
    }

    function logOut() {
        firebase.auth().signOut();
    }

    function fillpage() {
        var name = document.getElementById("name-header");
        if(myuser.displayName != null){
        name.innerHTML = myuser.displayName;
      }

        var image = document.getElementById("profileimage");
        if(myuser.photoURL != null){
        image.src = myuser.photoURL;
        }

        var type = document.getElementById("type-header");
        firebase.database().ref("Teachers/" + myuser.uid).once("value", snapshot => {
            const data = snapshot.val();
            if (data) {type.innerHTML = "Teacher account"} else {type.innerHTML = "Student account"}
        });


    }

    function resetpass() {
        firebase.auth().sendPasswordResetEmail(myuser.email).then(function() {
            alert("Password reset email has been sent");
        }).catch(function(error) {
            // An error happened.
        });
    }

    function emailchange() {
        var oldemail = myuser.email;
        var echange = $("#inputEmail3").val();
        alert(echange);
        myuser.updateEmail(echange).then(function() {
            alert("Email has been changed");
        }).catch(function(error) {
            alert("Invalid email or need to re-log");
        });
    }

    function imageChange() {
        var image = $("#imageURL").val();
        myuser.updateProfile({
            photoURL : image
        }).then(function(){
            fillpage();
        });
    }

    function nameChange() {
      var name = $("#realName").val();
      myuser.updateProfile({
        displayName: name
      }).then(function(){
        fillpage();
      });
    }
    
    function teacherSub() {
        firebase.database().ref("teachercode").once("value",snapshot => {
            var code = $("#teachercode").val();
            const data = snapshot.val();
            if(code == data)
                {
                    var postData = {
                        blank : "null"
                    };
                    var updates = {};
                    updates['Teachers/'+myuser.uid] = postData;
                    firebase.database().ref().update(updates);
                }
        });
    }

</script>
